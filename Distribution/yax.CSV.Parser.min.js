!function(){"use strict";var e=function(e){return!Y.Lang.isUndefined(e)},t=/^(\-|\+)?([0-9]+(\.[0-9]+)?|Infinity)$/,n=function(e){return e=e.toLowerCase(),"true"===e||"false"===e},i=function(e,i,r,s){var o,a="return ",c=s?function(e,i){return t.test(e)?"Number(values["+i+"]),":n(e)?"Boolean(values["+i+"].toLowerCase() === 'true'),":"String(values["+i+"]),"}:function(e,t){return"values["+t+"],"};if("object"===e){for(a+="{",o=0;o<i.length;++o)a+='"'+i[o]+'": '+c(r[o],o);a=a.slice(0,-1)+"}"}else{for(a+="[",o=0;o<i.length;++o)a+=c(r[o],o);a=a.slice(0,-1)+"]"}return new Function("values",a)};Y.Parser.MergeObject("Drivers",{CSV:{ID:"Y.Parser.Drivers.CSV",Options:null,Data:null,dataSource:function(t,n){var i,r,s;if(n=e(n)?n:{},this.Options={async:e(n.async)?n.async:!1,cast:e(n.cast)?n.cast:!0,line:e(n.line)?n.line:"\r\n",delimiter:e(n.delimiter)?n.delimiter:",",header:e(n.header)?n.header:!1,done:e(n.done)?n.done:void 0},this.Data=t,this.Data instanceof Array)return this;for(i=0;i<this.Options.line.length;i++)r=t.charCodeAt(t.length-this.Options.line.length+i),s=this.Options.line.charCodeAt(i),r!==s&&(this.Data+=this.Options.line.charAt(i));return this},set:function(e,t){return this.Options[e]=t,this},encode:function(e){if(0===this.Data.length)return Y.Lang.empty();var t,n,i,r,s,o,a=this.Data,c=[],l=this.Options.delimiter,h=a[0]instanceof Array?"array":"object",u=this.Options.header,f=this.Options.done,d=function(e){return e?"string"!=typeof e?e:'"'+e.replace(/\"/g,'""')+'"':null},p=e?function(t){e(t.join(l))}:function(e){c.push(e.join(l))},g=a.length;if("object"===h?(i=Object.keys(a[0]),r=i.length):r=a[0].length,o=new Array(r),u){var O=u instanceof Array?u:i;for(n=0;r>n;++n)o[n]=d(O[n]);p(o)}if("object"===h)for(t=0;g>t;++t){for(s=a[t],n=0;r>n;++n)o[n]=d(s[i[n]]);p(o)}else for(t=0;g>t;++t){for(s=a[t],n=0;r>n;++n)o[n]=d(s[n]);p(o)}return c=c.join(this.Options.line),f&&f(c),c},forEach:function(e){return this.Data instanceof Array?this.encode(e):this.parse(e)},parse:function(e){if(0===this.Data.trim().length)return[];var t,n,r,s,o=this.Data,a=[],c=this.Options.done,l=this.Options.cast,h=this.Options.header,u=h instanceof Array?h:[],f=this.Options.line,d=u.length,p={row:[],cell:""},g={escaped:!1,quote:!1,cell:!0},O=function(e){p.row.push((g.escaped?e.slice(1,-1).replace(/""/g,'"'):e).trim()),p.cell="",g={escaped:!1,quote:!1,cell:!0}},w=1===f.length?O:function(e){O(e.slice(0,1-f.length))},y=e?function(){e(new t(p.row))}:function(){a.push(new t(p.row))},v=function(){h?d?(t=new i("object",u,p.row,l),y(),v=y):(u=p.row,d=u.length):(t||(t=new i("array",p.row,p.row,l)),y(),v=y)},A=o.length,D=f.charCodeAt(f.length-1),j=this.Options.delimiter.charCodeAt(0);for(n=0,r=0;A>=r;++r)s=o.charCodeAt(r),g.cell&&(g.cell=!1,34===s)?g.escaped=!0:g.escaped&&34===s?g.quote=!g.quote:(g.escaped&&g.quote||!g.escaped)&&(s===j?(O(p.cell+o.slice(n,r)),n=r+1):s===D&&(w(p.cell+o.slice(n,r)),n=r+1,v(),p.row=[]));return c&&c(a),a}}})}();