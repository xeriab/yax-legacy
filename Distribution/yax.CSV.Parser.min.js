!function(){"use strict";var e=function(e){return!Y.isUndefined(e)},t=/^(\-|\+)?([0-9]+(\.[0-9]+)?|Infinity)$/,n=function(e){return e=e.toLowerCase(),"true"===e||"false"===e},i=function(e,i,r,o){var s,a="return ",c=o?function(e,i){return t.test(e)?"Number(values["+i+"]),":n(e)?"Boolean(values["+i+"].toLowerCase() === 'true'),":"String(values["+i+"]),"}:function(e,t){return"values["+t+"],"};if("object"===e){for(a+="{",s=0;s<i.length;++s)a+='"'+i[s]+'": '+c(r[s],s);a=a.slice(0,-1)+"}"}else{for(a+="[",s=0;s<i.length;++s)a+=c(r[s],s);a=a.slice(0,-1)+"]"}return new Function("values",a)};Y.Parser.mergeObject("drivers",{CSV:{id:"Y.Parser.drivers.CSV",options:null,data:null,dataSource:function(t,n){var i,r,o;if(n=e(n)?n:{},this.options={async:e(n.async)?n.async:!1,cast:e(n.cast)?n.cast:!0,line:e(n.line)?n.line:"\r\n",delimiter:e(n.delimiter)?n.delimiter:",",header:e(n.header)?n.header:!1,done:e(n.done)?n.done:void 0},this.data=t,this.data instanceof Array)return this;for(i=0;i<this.options.line.length;i++)r=t.charCodeAt(t.length-this.options.line.length+i),o=this.options.line.charCodeAt(i),r!==o&&(this.data+=this.options.line.charAt(i));return this},set:function(e,t){return this.options[e]=t,this},encode:function(e){if(0===this.data.length)return Y.empty;var t,n,i,r,o,s,a=this.data,c=[],l=this.options.delimiter,h=a[0]instanceof Array?"array":"object",u=this.options.header,d=this.options.done,f=function(e){return e?"string"!=typeof e?e:'"'+e.replace(/\"/g,'""')+'"':null},p=e?function(t){e(t.join(l))}:function(e){c.push(e.join(l))},g=a.length;if("object"===h?(i=Object.keys(a[0]),r=i.length):r=a[0].length,s=new Array(r),u){var w=u instanceof Array?u:i;for(n=0;r>n;++n)s[n]=f(w[n]);p(s)}if("object"===h)for(t=0;g>t;++t){for(o=a[t],n=0;r>n;++n)s[n]=f(o[i[n]]);p(s)}else for(t=0;g>t;++t){for(o=a[t],n=0;r>n;++n)s[n]=f(o[n]);p(s)}return c=c.join(this.options.line),d&&d(c),c},forEach:function(e){return this.data instanceof Array?this.encode(e):this.parse(e)},parse:function(e){if(0===this.data.trim().length)return[];var t,n,r,o,s=this.data,a=[],c=this.options.done,l=this.options.cast,h=this.options.header,u=h instanceof Array?h:[],d=this.options.line,f=u.length,p={row:[],cell:""},g={escaped:!1,quote:!1,cell:!0},w=function(e){p.row.push((g.escaped?e.slice(1,-1).replace(/""/g,'"'):e).trim()),p.cell="",g={escaped:!1,quote:!1,cell:!0}},y=1===d.length?w:function(e){w(e.slice(0,1-d.length))},v=e?function(){e(new t(p.row))}:function(){a.push(new t(p.row))},A=function(){h?f?(t=new i("object",u,p.row,l),v(),A=v):(u=p.row,f=u.length):(t||(t=new i("array",p.row,p.row,l)),v(),A=v)},j=s.length,m=d.charCodeAt(d.length-1),C=this.options.delimiter.charCodeAt(0);for(n=0,r=0;j>=r;++r)o=s.charCodeAt(r),g.cell&&(g.cell=!1,34===o)?g.escaped=!0:g.escaped&&34===o?g.quote=!g.quote:(g.escaped&&g.quote||!g.escaped)&&(o===C?(w(p.cell+s.slice(n,r)),n=r+1):o===m&&(y(p.cell+s.slice(n,r)),n=r+1,A(),p.row=[]));return c&&c(a),a}}})}();